<form
  #candidateForm="ngForm"
  (ngSubmit)="onSubmit(candidateForm)"
  novalidate
  class="candidate-container"
  [class.form-invalid]="
    candidateForm.invalid && (candidateForm.touched || candidateForm.dirty)
  "
>
  <fieldset class="card">
    <legend>Identité du candidat</legend>

    <div class="form-group">
      <label for="name">Nom complet</label>
      <input
        id="name"
        name="name"
        type="text"
        [(ngModel)]="candidate.name"
        (ngModelChange)="onCandidateChange()"
        #name="ngModel"
        required
        minlength="5"
        [ngClass]="{
          valid: name.valid && name.dirty,
          invalid: name.invalid && name.dirty,
          'input-valid-bg': name.valid && name.dirty,
          'input-invalid-bg': name.invalid && name.dirty,
        }"
      />
      <div class="errors" *ngIf="name.dirty && name.invalid">
        <div *ngIf="name.errors?.['required']">Nom requis</div>
        <div *ngIf="name.errors?.['minlength']">Minimum 5 caractères</div>
      </div>
    </div>

    <div class="form-group">
      <label for="email">Email professionnel</label>
      <input
        id="email"
        name="email"
        type="email"
        [(ngModel)]="candidate.email"
        (ngModelChange)="onCandidateChange()"
        #email="ngModel"
        required
        email
        [ngClass]="{
          valid: email.valid && email.dirty,
          invalid: email.invalid && email.dirty,
          'input-valid-bg': email.valid && email.dirty,
          'input-invalid-bg': email.invalid && email.dirty,
        }"
      />
      <div class="errors" *ngIf="email.dirty && email.invalid">
        <div *ngIf="email.errors?.['required']">Email requis</div>
        <div *ngIf="email.errors?.['email']">Format invalide</div>
      </div>
    </div>

    <div class="form-group">
      <label for="level">Niveau</label>
      <select
        id="level"
        name="level"
        [(ngModel)]="candidate.level"
        (ngModelChange)="onCandidateChange()"
        #level="ngModel"
        required
        [ngClass]="{
          valid: level.valid && level.dirty,
          invalid: level.invalid && level.dirty,
          'input-valid-bg': level.valid && level.dirty,
          'input-invalid-bg': level.invalid && level.dirty,
        }"
      >
        <option value="Junior">Junior</option>
        <option value="Intermédiaire">Intermédiaire</option>
        <option value="Senior">Senior</option>
      </select>
      <div class="errors" *ngIf="level.dirty && level.invalid">
        <div *ngIf="level.errors?.['required']">Niveau requis</div>
      </div>
    </div>

    <fieldset ngModelGroup="preferences">
      <legend>Préférences de mission</legend>

      <label>
        <input
          type="radio"
          name="contractType"
          value="CDI"
          [(ngModel)]="candidate.preferences.contractType"
          (ngModelChange)="onCandidateChange()"
        />
        CDI
      </label>
      <br />
      <label>
        <input
          type="radio"
          name="contractType"
          value="Freelance"
          [(ngModel)]="candidate.preferences.contractType"
          (ngModelChange)="onCandidateChange()"
        />
        Freelance
      </label>

      <br />

      <label>
        <input
          type="checkbox"
          name="available"
          [(ngModel)]="candidate.preferences.available"
          (ngModelChange)="onCandidateChange()"
        />
        Disponible immédiatement
      </label>
    </fieldset>

    <div class="form-group">
      <label for="bio">Pitch Personnel</label>
      <textarea
        id="bio"
        name="bio"
        [(ngModel)]="candidate.bio"
        (ngModelChange)="onCandidateChange()"
        #bio="ngModel"
        required
        minlength="20"
        maxlength="200"
        placeholder="Parlez-nous de vous (20 à 200 caractères)..."
        [ngClass]="{
          valid: bio.valid && bio.dirty,
          invalid: bio.invalid && bio.dirty,
          'input-valid-bg': bio.valid && bio.dirty,
          'input-invalid-bg': bio.invalid && bio.dirty,
        }"
      ></textarea>

      <div
        class="char-counter"
        [style.color]="candidate.bio.length > 180 ? 'red' : 'inherit'"
        style="text-align: right; font-size: 0.8rem; margin-top: 5px"
      >
        {{ candidate.bio.length }} / 200 caractères
      </div>

      <div class="errors" *ngIf="bio.dirty && bio.errors?.['minlength']">
        <div>Le pitch doit faire au moins 20 caractères.</div>
      </div>
    </div>

    <button type="submit" [disabled]="candidateForm.invalid" class="btn-submit">
      Postuler
    </button>
  </fieldset>
</form>
